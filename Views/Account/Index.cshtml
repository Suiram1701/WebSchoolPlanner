@inject IViewLocalizer _localizer;
@inject SignInManager<User> _signInManager;
@inject UserManager<User> _userManager;

@{
    ViewData["Title"] = _localizer["Title"];

    User user = (await _userManager.GetUserAsync(User))!;
}

@section HeadScripts {
    <script type="module" src="~/js/Account/Index.js" async></script>
}

<div class="text-center">
    <h3>@_localizer["Title"]</h3>

    <div class="m-3">
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            @{
                List<string> tabNames = new()
                {
                    "general",
                    "security"
                };
            }
            @foreach (string tabName in tabNames)
            {
                <li class="nav-item" role="presentation">
                    <button class="nav-link @{if (tabName == tabNames[0]) {<text>active</text>}}" id="@(tabName)-tab" data-bs-toggle="tab" data-bs-target="#@(tabName)-tab-pane" type="button" role="tab" aria-controls="@(tabName)-tab-pane" aria-selected="@(tabName == tabNames[0])" data-tab-name="@tabName">
                        @_localizer[tabName]
                    </button>
                </li>
            }
        </ul>
        <div class="tab-content mt-5" id="presentation">
            <div class="tab-pane fade show active" id="general-tab-pane" role="tabpanel" aria-labelledby="general-tab" tabindex="0">
                General
            </div>
            <div class="tab-pane fade" id="security-tab-pane" role="tabpanel" aria-labelledby="security-tab" tabindex="1">

                <!-- 2FA settings -->
                <h3 class="text-start fw-light">@_localizer["TFA"]</h3>
                <hr />

                <p class="lead text-body-secondary">
                    @_localizer["TFA_Description"]
                </p> 

                <div class="d-flex flex-wrap justify-content-center">

                    <!-- App auth -->
                    <div class="d-flex flex-column flex-nowrap m-3">
                        <div class="d-flex">
                            <img src="~/img/phone_iphone.svg" class="me-2" height="35" width="35" />
                            <h4 class="fw-light">@_localizer["TFA_App"]</h4>
                        </div>

                        <div class="d-flex flex-column my-2">
                            @if (await _signInManager.IsTwoFactorEnabledAsync(user))
                            {
                                <a class="btn btn-danger" asp-controller="Auth" asp-action="Validate2fa" asp-route-r="/account#security" asp-route-y="disable2fa" >@_localizer["Deactivate"]</a>
                            }
                            else
                            {
                                <a class="btn btn-primary" asp-controller="Account" asp-action="Enable2fa">@_localizer["Activate"]</a>
                            }
                        </div>
                    </div>

                    <!-- Email auth -->
                    <div class="m-3">
                        Email
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>